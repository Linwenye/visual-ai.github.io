<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="description"
        content="Mr. DETR: Instructive Multi-Route Training for Detection Transformers">
  <meta name="keywords" content="Object Detection, Detection Transformer">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Mr. DETR: Instructive Multi-Route Training for Detection Transformers</title>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-PYVRSFMDRL"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }

    gtag('js', new Date());

    gtag('config', 'G-PYVRSFMDRL');
  </script>

  <link href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro"
        rel="stylesheet">

  <link rel="stylesheet" href="./static/css/bulma.min.css">
  <link rel="stylesheet" href="./static/css/bulma-carousel.min.css">
  <link rel="stylesheet" href="./static/css/bulma-slider.min.css">
  <link rel="stylesheet" href="./static/css/fontawesome.all.min.css">
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
  <link rel="stylesheet" href="./static/css/index.css">
  <link rel="icon" href="./static/images/visailab.jpeg">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script defer src="./static/js/fontawesome.all.min.js"></script>
  <script src="./static/js/bulma-carousel.min.js"></script>
  <script type="text/javascript" src="./static/js/copy.js"></script>
  <script src="./static/js/bulma-slider.min.js"></script>
  <script src="./static/js/index.js"></script>
</head>
<body>

<section class="hero">
  <div class="hero-body">
    <div class="container is-max-desktop">
      <div class="columns is-centered">
        <div class="column has-text-centered">
          <h1 class="title is-1 publication-title">Mr. DETR: Instructive Multi-Route Training for Detection Transformers</h1>
          <div class="is-size-5 publication-authors">
            <span class="author-block">
              <a href="https://zhangchbin.github.io">Chang-Bin Zhang</a><sup>1</sup>,</span>
            <span class="author-block">
              <a href="https://y-zhong.info">Yujie Zhong</a><sup>2</sup>,</span>
            <span class="author-block">
              <a href="https://www.kaihan.org/">Kai Han</a><sup>1</sup>
            </span>
          </div>

          <div class="is-size-5 publication-authors">
            <span class="author-block"><sup>1</sup>Visual AI Lab, The University of Hong Kong</span>
            <br>
            <span class="author-block"><sup>2</sup>Meituan Inc.</span>
          </div>

          <div class="column has-text-centered">
            <div class="publication-links">
              <!-- PDF Link. -->
              <span class="link-block">
                <a href="https://arxiv.org/pdf/2412.10028"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fas fa-file-pdf"></i>
                  </span>
                  <span>Paper</span>
                </a>
              </span>
              <span class="link-block">
                <a href="https://arxiv.org/abs/2412.10028"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="ai ai-arxiv"></i>
                  </span>
                  <span>arXiv</span>
                </a>
              </span>
              <!-- HuggingFace Demo Link -->
              <span class="link-block">
                <a href="https://huggingface.co/spaces/allencbzhang/Mr.DETR"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fas fa-robot"></i>
                  </span>
                  <span>HF Demo</span>
                </a>
              </span>
              <!-- Code Link. -->
              <span class="link-block">
                <a href="https://github.com/Visual-AI/Mr.DETR"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fab fa-github"></i>
                  </span>
                  <span>Code</span>
                  </a>
              </span>
              <!-- Dataset Link. -->
              <span class="link-block">
                <a href="#Bib"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="far fa-images"></i>
                  </span>
                  <span>BibTex</span>
                  </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="section">
  <div class="container is-max-desktop">
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">Performance</h2>
        <div>
          <figure>
            <img src="src/improve.png" alt="Improvement across baselines" style="width:90%; height:auto;">
            <figcaption style="font-size: 1.2em; font-weight: bold; margin-bottom: 40px;">Improvement across baselines</figcaption>
          </figure>
        </div>
        <div>
          <figure>
            <img src="src/converge.png" alt="Convergency curve" style="width:110%; height:auto;">
            <figcaption style="font-size: 1.2em; font-weight: bold;">Convergency curve</figcaption>
          </figure>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Image Carousel Section -->
<section class="section">
  <div class="container is-max-desktop">
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">Qualitative Results</h2>
        <div class="image-carousel" style="position: relative; display: inline-block; width: 100%;">
          <button class="carousel-button prev" onclick="prevImage()"></button>
          <img id="carousel-image" src="resources/Picture1.png" alt="Image 1" style="width:100%; height:auto;">
          <button class="carousel-button next" onclick="nextImage()"></button>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .carousel-button {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 0;
    height: 0;
    border-style: solid;
    opacity: 0.7;
    cursor: pointer;
    background: transparent;
  }

  .prev {
    left: -60px;
    border-width: 15px 20px 15px 0;
    border-color: transparent #000 transparent transparent;
  }

  .next {
    right: -60px;
    border-width: 15px 0 15px 20px;
    border-color: transparent transparent transparent #000;
  }

  .carousel-button:hover {
    opacity: 1;
  }

  .publication-title {
    text-align: center;
    font-style: normal;
  }
</style>

<script>
  const images = [
    'resources/Picture1.png',
    'resources/Picture2.png',
    'resources/Picture3.png',
    'resources/Picture4.png',
    'resources/Picture5.png',
    'resources/Picture6.png',
    'resources/Picture7.png',
    'resources/Picture8.png',
    'resources/Picture9.png',
    'resources/Picture10.png',
    'resources/Picture11.png',
    'resources/Picture12.png',
    'resources/Picture13.png',
    'resources/Picture14.png',
    'resources/Picture15.png',
    'resources/Picture16.png',
  ];
  let currentIndex = 0;

  function showImage(index) {
    const imgElement = document.getElementById('carousel-image');
    imgElement.src = images[index];
  }

  function prevImage() {
    currentIndex = (currentIndex > 0) ? currentIndex - 1 : images.length - 1;
    showImage(currentIndex);
  }

  function nextImage() {
    currentIndex = (currentIndex < images.length - 1) ? currentIndex + 1 : 0;
    showImage(currentIndex);
  }

  // Initialize the carousel with the first image
  showImage(currentIndex);
</script>

<section class="section">
    <div class="container is-max-desktop">
      <!-- Abstract. -->
      <div class="columns is-centered has-text-centered">
        <div class="column is-four-fifths">
          <h2 class="title is-3">Our Findings</h2>
          <section class="hero teaser">
            <div class="container is-max-desktop">
              <div class="hero-body">
                  <p><strong style="color: rgb(194, 130, 11);">Based on the multi-task training framework that is required to achieve one-to-one and one-many prediction, any independent component significantly benefits the primary route of one-to-one prediction, even when other components are shared.</strong> </p> 
              </div>
              <div class="hero-body">
                <!-- <p style="text-align: justify;">We first build the multi-task framework and empirically investigate the roles of each component in the
                  transformer decoder for one-to-one and one-to-many assignments, including self-attention, cross-attention, and the feed-
                  forward network (FFN). Specifically, we regard the model with auxiliary training by one-to-many assignment as a typical
                  multi-task framework, requiring simultaneous one-to-one and one-to-many predictions. As illustrated in Fig. 1(a), the
                  most straightforward approach is to obtain the prediction results of two tasks with shared components. However, experimental results in Tab. 1(1) indicate that incorporating a
                  one-to-many assignment significantly degrades the performance of the primary one-to-one prediction when all components are shared between two tasks. Consequently, we investigate which component can be independent to enhance
                  the primary route's performance. We build the multi-task
                  framework with independent self-attention, cross-attention,
                  and FFN for two training targets, as shown in Fig. 1(b-d),
                  respectively. We find that any independent component significantly benefits the primary route of one-to-one prediction,
                  even when other components are shared, achieving 2.1%,
                  1.6%, and 2.0% improvement, respectively, as demonstrated
                  in Tab. 1(3-5). </p>

                  <p style="text-align: justify;">
                    <strong>This empirical finding motivates us to build a multi-route
                      training mechanism that combines multiple auxiliary training routes, each with an independent component. </strong>
                      The combination in Fig. 1(e) outperforms other variants, leading us to adopt this framework as our potential solution.
                      To further reduce the new trainable parameters in the auxiliary training routes and enhance parameter sharing across all routes, we propose a novel instructive self-attention mechanism, depicted in Fig. 1(f). 
                      
                    </p> -->
              </div>
            </div>
            
            <div class="col justify-content-center text-center"></div>
                <div class="col-sm-12">
                    <figure style="text-align: left; margin-top: 20px;">
                        <img src="src/variants.png" alt="Description of image" style="display: block; margin: 0 auto; width:100%; height:auto;">
                    </figure>
                </div>
            </div>
          </section>
          <section class="section">
            <div class="container is-max-desktop">
              <h2 class="title is-3"></h2>
              <div class="table-container">
                <table class="table is-striped" style="width: 80%; margin: 0 auto; table-layout: fixed;">
                  <thead>
                    <tr>
                      <th style="width: 10%; text-align: left;">No</th>
                      <th class="has-text-left" style="width: 40%;">Configurations</th>
                      <th style="width: 10%; text-align: center;">Routes</th>
                      <th style="width: 20%; text-align: center;">o2o</th>
                      <th style="width: 20%; text-align: center;">o2m w/ NMS</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td style="text-align: left;">(1)</td>
                      <td class="has-text-left">One-to-one only</td>
                      <td style="text-align: center;">1</td>
                      <td style="text-align: center;">47.6</td>
                      <td style="text-align: center;">-</td>
                    </tr>
                    <tr>
                      <td style="text-align: left;">(2)</td>
                      <td class="has-text-left">Share All</td>
                      <td style="text-align: center;">1</td>
                      <td style="text-align: center;">41.6 <span style="color:red;">(-6.0)</span></td>
                      <td style="text-align: center;">41.6</td>
                    </tr>
                    <tr>
                      <td style="text-align: left;">(3)</td>
                      <td class="has-text-left">Not shared Self-Attention</td>
                      <td style="text-align: center;">2</td>
                      <td style="text-align: center;">49.7 <span style="color:blue;">(+2.1)</span></td>
                      <td style="text-align: center;">50.3</td>
                    </tr>
                    <tr>
                      <td style="text-align: left;">(4)</td>
                      <td class="has-text-left">Not shared Cross-Attention</td>
                      <td style="text-align: center;">2</td>
                      <td style="text-align: center;">49.2 <span style="color:blue;">(+1.6)</span></td>
                      <td style="text-align: center;">50.0</td>
                    </tr>
                    <tr>
                      <td style="text-align: left;">(5)</td>
                      <td class="has-text-left">Not shared FFN</td>
                      <td style="text-align: center;">2</td>
                      <td style="text-align: center;">49.6 <span style="color:blue;">(+2.0)</span></td>
                      <td style="text-align: center;">50.1</td>
                    </tr>
                    <tr>
                      <td style="text-align: left;">(6)</td>
                      <td class="has-text-left">Shared Self-Attention</td>
                      <td style="text-align: center;">2</td>
                      <td style="text-align: center;">49.4 <span style="color:blue;">(+1.8)</span></td>
                      <td style="text-align: center;">50.3</td>
                    </tr>
                    <tr>
                      <td style="text-align: left;">(7)</td>
                      <td class="has-text-left">Shared Cross-Attention</td>
                      <td style="text-align: center;">2</td>
                      <td style="text-align: center;">49.4 <span style="color:blue;">(+1.8)</span></td>
                      <td style="text-align: center;">50.0</td>
                    </tr>
                    <tr>
                      <td style="text-align: left;">(8)</td>
                      <td class="has-text-left">Shared FFN</td>
                      <td style="text-align: center;">2</td>
                      <td style="text-align: center;">49.2 <span style="color:blue;">(+1.6)</span></td>
                      <td style="text-align: center;">50.0</td>
                    </tr>
                    <tr>
                      <td style="text-align: left;">(9)</td>
                      <td class="has-text-left">(3) + (4)</td>
                      <td style="text-align: center;">3</td>
                      <td style="text-align: center;">49.4 <span style="color:blue;">(+1.8)</span></td>
                      <td style="text-align: center;">49.9</td>
                    </tr>
                    <tr>
                      <td style="text-align: left;">(10)</td>
                      <td class="has-text-left">(3) + (5)</td>
                      <td style="text-align: center;">3</td>
                      <td style="text-align: center;">50.0 <span style="color:blue;">(+2.4)</span></td>
                      <td style="text-align: center;">50.8</td>
                    </tr>
                    <tr>
                      <td style="text-align: left;">(11)</td>
                      <td class="has-text-left">(4) + (5)</td>
                      <td style="text-align: center;">3</td>
                      <td style="text-align: center;">49.0 <span style="color:blue;">(+1.4)</span></td>
                      <td style="text-align: center;">49.6</td>
                    </tr>
                    <tr>
                      <td style="text-align: left;">(12)</td>
                      <td class="has-text-left">(3) + (4) + (5)</td>
                      <td style="text-align: center;">4</td>
                      <td style="text-align: center;">49.6 <span style="color:blue;">(+2.0)</span></td>
                      <td style="text-align: center;">50.2</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </section>
          
        </div>
      </div>
    </div>
  </section>

  <section class="section">
    <div class="container is-max-desktop">
      <!-- Abstract. -->
      <div class="columns is-centered has-text-centered">
        <div class="column is-four-fifths">
          <h2 class="title is-3">Method</h2>
          <div class="col justify-content-center text-center">
          </div>
          <div class="content has-text-justified">
            <div class="col justify-content-center text-center">
              <p>Our method includes three training routes: Route-1, Route-2, and Route-3.
                All three routes share the same object queries and detection heads for classification and regression. Route-2 serves as the primary route
                for one-to-one prediction, identical to the baseline models. Route-1 shares self-attention and cross-attention but uses an independent
                feed-forward network (o2m FFN) for one-to-many prediction. Route-3, sharing all components with the primary route, introduces a novel
                instructive self-attention, implemented by adding a learnable instruction token to the object queries to guide them and the subsequent
                network for one-to-many prediction. During inference, the auxiliary routes, Route-1 and Route-3, are discarded.</p>
          </div>
            <div class="col justify-content-center text-center">
              <div class="col-sm-12">
                <figure style="text-align: left; margin-top: 20px;">
                    <img src="src/Method.png" alt="Description of image" style="display: block; margin: 0 auto; width:100%; height:auto;">
                    <figcaption style="font-size: 1.2em; font-weight: bold; text-align: center; font-style: normal; margin-top: 10px;">Illustration of our proposed multi-route training method</figcaption>
                  </figure>
            </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>





  <section class="section">
    <div class="container is-max-desktop">
      <!-- Abstract. -->
      <div class="columns is-centered has-text-centered">
        <div class="column is-four-fifths">
          <h2 class="title is-3">Quantatitve Results</h2>
          <div class="col justify-content-center text-center">
            <div class="col-sm-12">
              <figure style="text-align: left;">
                  <img src="src/expcoco.png" alt="Description of image" style="display: block; margin: 0 auto; width:100%; height:auto;">
                  <figcaption><strong>The performance on the COCO 2017 validation set.</strong>All models are based on the ResNet-50 backbone.</figcaption>
              </figure>
          </div>
          
          </div>
          <div class="col justify-content-center text-center" style="margin-top: 20px; margin-bottom: 20px;"></div>
            <div class="col-sm-12">
              <figure style="text-align: left;">
                  <img src="src/expswinl.png" alt="Description of image" style="display: block; margin: 0 auto; width:100%; height:auto;">
                  <figcaption> <strong>The performance on the COCO 2017 validation set based on the Swin-L backbone.</strong></figcaption>
              </figure>
          </div>
          </div>
          </div>
        </div>
      </div>
    </div>
  </section>


  <section class="section"></section>
    <div class="container is-max-desktop">
      <!-- Abstract. -->
      <div class="columns is-centered has-text-centered">
        <div class="column is-four-fifths">
          <h2 class="title is-3">Extension to Instance Segmentation</h2>
          <div class="col justify-content-center text-center">
            <div class="col-sm-12">
              <div class="table-container">
                <table class="table is-striped is-fullwidth">
                  <thead>
                    <tr>
                      <th>Epochs</th>
                      <th>w/ Mr. DETR</th>
                      <th>Mask mAP</th>
                      <th>Box mAP</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>12</td>
                      <td></td>
                      <td>32.4</td>
                      <td>46.5</td>
                    </tr>
                    <tr style="background-color: #f0f0f0;">
                      <td>12</td>
                      <td>✔</td>
                      <td><strong>36.0</strong> <span style="color:blue;">(+3.6)</span></td>
                      <td><strong>49.5</strong> <span style="color:blue;">(+3.0)</span></td>
                    </tr>
                    <tr>
                      <td>24</td>
                      <td></td>
                      <td>35.1</td>
                      <td>48.6</td>
                    </tr>
                    <tr style="background-color: #f0f0f0;">
                      <td>24</td>
                      <td>✔</td>
                      <td><strong>37.6</strong> <span style="color:blue;">(+2.5)</span></td>
                      <td><strong>50.3</strong> <span style="color:blue;">(+1.7)</span></td>
                    </tr>
                  </tbody>
                </table>
                <p style="text-align: left;"><strong>Instance segmentation results on the COCO 2017 validation set.</strong> All experiments are based on the Deformable-DETR++ with 300 queries and ResNet-50 as backbone.</p>
              </div>
            </div>
          </div>
        
          </div>
          </div>
        </div>
      </div>
    </div>
  </section>





  <section class="section">
    <div class="container is-max-desktop">
      <!-- Abstract. -->
      <div class="columns is-centered has-text-centered">
        <div class="column is-four-fifths">
          <h2 class="title is-3">Effectiveness of our Instructive Self-Attention</h2>
          
          <div class="table-container">
            <table class="table is-striped is-fullwidth">
              <thead>
                <tr>
                  <th>Route-1</th>
                  <th>Route-2</th>
                  <th>Route-3</th>
                  <th>mAP</th>
                  <th>AP<sub>50</sub></th>
                  <th>AP<sub>75</sub></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>✔</td>
                  <td></td>
                  <td></td>
                  <td>47.6</td>
                  <td>65.8</td>
                  <td>51.8</td>
                </tr>
                <tr>
                  <td></td>
                  <td>✔</td>
                  <td></td>
                  <td>49.6 <span style="color:blue;">(+2.0)</span></td>
                  <td>67.4</td>
                  <td>54.2</td>
                </tr>
                <tr>
                  <td></td>
                  <td></td>
                  <td>✔</td>
                  <td>50.4 <span style="color:blue;">(+2.8)</span></td>
                  <td>67.9</td>
                  <td>55.3</td>
                </tr>
                <tr style="background-color: #f0f0f0;">
                  <td>✔</td>
                  <td>✔</td>
                  <td>✔</td>
                  <td><strong>50.7</strong> <span style="color:blue;">(+3.1)</span></td>
                  <td><strong>68.2</strong></td>
                  <td><strong>55.4</strong></td>
                </tr>
              </tbody>
            </table>
            <p style="text-align: left;"><strong>The ablation study of different routes in our method.</strong> 'Route-1': the auxiliary training route with independent FFN.
              'Route-2': the primary route for one-to-one prediction. 'Route-3': the auxiliary training route with instructive self-attention.</p>
          </div>
          

          <p style="text-align: justify; margin-top: 20px;">
            We further visualize the attention maps of the instructive self-attention, which reveals that when the 300 object queries act as query and the 10 instruction
            tokens as key, nearly all 300 object queries exhibit strong
            activation with the instruction tokens. This indicates that
            instruction tokens effectively convey information to object
            queries and subsequent network layers, aiding the model in
            achieving one-to-many predictions.
          </p>
          
          <div class="col justify-content-center text-center"></div>
            <div class="col-sm-12">
              <figure style="text-align: left;">
                  <img src="src/isattn.png" alt="Description of image" style="display: block; margin: 0 auto; width:100%; height:auto;">
                  <figcaption> <strong>Visualization of attention maps for instructive self-attention.</strong>We use Deformable-DETR++ with 300 object queries and 10
                    instruction tokens for this visualization. The first 10 tokens are instruction tokens. The vertical and horizontal axes represent the Query and
                    Key, respectively.</figcaption>
              </figure>
          </div>
          </div>

          
          </div>
        </div>
      </div>
    </div>
  </section>





  <section class="section" id="Bib">
    <div class="container is-max-desktop content">
      <h2 class="title">BibTeX</h2>
<pre><code id="BibTeX">@inproceedings{zhang2024mr,
  title={Mr. DETR: Instructive Multi-Route Training for Detection Transformers},
  author={Zhang, Chang-Bin and Zhong, Yujie and Han, Kai},
  booktitle={Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition},
  year={2025}
}
</code><button class="copy-button" style="--button-hover-background: var(--example-color-alt); --button-color: var(--white); --button-background: var(--example-color-alt); --button-margin-bottom: 0;" class="copyButton btn" onclick="copyToClipboard('BibTeX','BibTeX_cop')"><i class="fa fa-copy"></i></button><p id="BibTeX_cop" style="display:none;color: #a0a0a0">Copied!</p></pre>
    </div>
  </section>


  <section class="section" id="footer">
    <div class="columns is-centered">
      <div class="column is-8">
        <div class="content">
          <p>
          <center>
            This website is based on <a href="https://nerfies.github.io/">Nerfies</a>.
          </center>
          </p>
        </div>
      </div>
    </div>
  </div>
 </section>


</body>
</html>
